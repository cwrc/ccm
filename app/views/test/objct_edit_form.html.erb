<% content_for :head do %>
	<%= stylesheet_link_tag "entitymgr.css" %>
	
	<script type="text/javascript">
	
		$(document).ready(function() 
		{
		   $("#edit_form").submit(function(event)
		   {
				//Prevent normal form submission
				event.preventDefault();
				
				//getting data from the form
				var $form = $(this),
				    term = $form.find('textarea[name="xml"]').val(),
				    pid = $form.find('input[name="pid"]').val();
				
				var args = (pid != null && pid != "") ? {xml: term, id: pid} : {xml: term};
				var $url = '<%= url_for :controller=>@api_controller, :action=>:save -%>';
				$.post($url, {xml: term, id: pid},
												function(data)
												{
											  		
											  		if(data != "-1")
											  		{
											  			window.location="<%= url_for(:controller=>:test, :action=>@test_action) -%>/?id=" + data;
											  		}
											  		else
											  		{
											  			alert("Failed to update the <%=@object_type-%>!!")
											  		}
											   	});
			
			});	//End: $("#edit_form").submit(function(event)	 
		 }); //End: $(document).ready(function()
		 
		 function delete_object(objectId)
		 {
		 	if(!confirm ('DELETE ' + objectId + '??'))
		 		return;
		 		
		 	var $url = '<%= url_for :controller=>@api_controller, :action=>:delete -%>';
		 	var args = {id: objectId};

			$.post($url, args,
							function(data)
							{
						  		
						  		if(data != "-1")
						  		{
						  			window.location="<%= url_for(:controller=>:test, :action=>@test_action) -%>";
						  		}
						  		else
						  		{
						  			alert("Failed to delete the <%=@object_type-%>!!")
						  		}
						   }); //End: .post
		 }
		 
		 function load_object(objectId)
		 {
		 	var $url = '<%= url_for :controller=>@api_controller, :action=>:index -%>/' + objectId;
			$.get($url, {},
							function(data)
							{
								var xml_string = new XMLSerializer().serializeToString(data);
								document.forms['edit_form'].elements["xml"].value = xml_string;
								document.forms['edit_form'].elements["pid"].value = objectId;
								document.forms['edit_form'].elements["pid"].value = objectId;
								
								document.getElementById('editor_title').innerHTML = "Update " + objectId;
								document.getElementById('create_button').value = "Update";
						   }); //End: .get
		 }		 
		 
		 
	</script>
<% end %>

<div id="left">

	<div class="sub-title"><%=@object_type-%> ID</div>
	<% @object_list.each do |x| %>
		<div class="entity-id">
			<a href="" onClick="load_object('<%=x.pid%>'); return false;"><%=x.pid%></a>&nbsp; |&nbsp;
			<a href="" onClick="delete_object('<%=x.pid%>'); return false;">[delete]</a>
		</div>
	<% end %>
	<br />
	<br />
	<br />
	<br />
	<% if @object_list.count > 10 %>
		<form action="<%= url_for(:controller=>:test, :action=>:delete_all_items) -%>" method="post">
			<input type="submit" value="Delete All Items" onsubmit="confirm('Are you REALLY SURE ??'"/>
		</form>
	<% end %>

</div>

<div id="right">
	<div id="create-panel">
		<div id="editor_title" class="page-title"> <% if !@object.nil?%> Update <%=@object.pid%><% else %>Input Information for a New <%=@object_type-%><% end %></div>
		
		<form action="#" id="edit_form" method="post">
			<% pid = @object.nil? || @object.pid.nil? ? "" : @object.pid %>
			<input type="hidden" name="pid" id="active_pid" value="<%= pid %>" />
			<textarea id="new_entity_editor" class="entity_editor" name="xml"><%= @object.get_xml_description unless @object.nil? %></textarea>
			<br />
			<% label = @object.nil? ? "Create" : "Update" %>
			<%= link_to "Reset", :controller=>:test, :action=>@test_action %> | <input type="submit" value="<%= label -%>" id="create_button" />
		</form>
	</div>

</div>

<div class="clear"></div>




